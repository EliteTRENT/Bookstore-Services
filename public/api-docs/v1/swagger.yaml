openapi: 3.0.1
info:
  title: Book Store App
  version: 1.0.0
  description: API documentation for the Book Store app.
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "JWT Authorization header using the Bearer scheme. Enter 'Bearer [space] your_token'."
paths:
  /api/v1/users:
    post:
      summary: User Signup
      description: Creates a new user account.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    name:
                      type: string
                      example: "John Doe"
                    email:
                      type: string
                      format: email
                      example: user@example.com
                    password:
                      type: string
                      format: password
                      example: "Password@123"
                    mobile_number:
                      type: string
                      example: "+919876543210"
                  required:
                    - name
                    - email
                    - password
                    - mobile_number
      responses:
        "201":
          description: User successfully created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User created successfully"
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 123
                      name:
                        type: string
                        example: "John Doe"
                      email:
                        type: string
                        format: email
                        example: user@example.com
                      mobile_number:
                        type: string
                        example: "+919876543210"
        "422":
          description: Validation error (unprocessable entity)
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                      example: "Email can't be blank"

  /api/v1/sessions:
    post:
      summary: User Login
      description: Authenticates an existing user and returns a JWT token.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      example: user@example.com
                    password:
                      type: string
                      format: password
                      example: "Password@123"
                  required:
                    - email
                    - password
      responses:
        "200":
          description: User successfully logged in
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Login successful"
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoiSm9obiBEb2UiLCJlbWFpbCI6InVzZXJAZXhhbXBsZS5jb20ifQ.signature"
        "422":
          description: Validation error (unprocessable entity)
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Email is not registered"
                example:
                  errors: "Wrong Password"

  /api/v1/users/password/forgot:
    post:
      summary: Forget Password
      description: Initiates a password reset by sending an OTP to the user's registered email via RabbitMQ.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                      format: email
                      example: user@example.com
                  required:
                    - email
      responses:
        "200":
          description: OTP successfully enqueued and sent to email
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "OTP has been sent to user@example.com, check your inbox"
                  otp:
                    type: integer
                    example: 123456
                  user_id:
                    type: integer
                    example: 123
                  otp_generated_at:
                    type: string
                    format: date-time
                    example: "2025-03-06T12:00:00Z"
        "422":
          description: Email not found or OTP enqueue failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Email is not registered"
                example:
                  errors: "Failed to send OTP, please try again"

  /api/v1/users/password/reset/{id}:
    post:
      summary: Reset Password
      description: Resets the user's password using a valid OTP received from the forget password endpoint.
      tags:
        - Users
      parameters:
        - name: id
          in: path
          required: true
          description: The ID of the user whose password is being reset
          schema:
            type: integer
            example: 123
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    new_password:
                      type: string
                      format: password
                      example: "NewPass@123"
                    otp:
                      type: integer
                      example: 123456
                  required:
                    - new_password
                    - otp
      responses:
        "200":
          description: Password successfully reset
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password successfully reset"
        "422":
          description: Validation error, user not found, or OTP invalid/expired
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "User not found"
                examples:
                  user_not_found:
                    value:
                      errors: "User not found"
                  invalid_otp:
                    value:
                      errors: "Invalid or expired OTP"
                  validation_error:
                    value:
                      errors: "Password can't be blank"

  /api/v1/books:
    post:
      summary: Create Book
      description: Creates a new book with the provided details
      tags:
        - Books
      security: 
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                book:
                  type: object
                  properties:
                    name:
                      type: string
                      example: "The Great Gatsby"
                      minLength: 1
                      description: "Book title (required)"
                    author:
                      type: string
                      example: "F. Scott Fitzgerald"
                      minLength: 1
                      description: "Author name (required)"
                    mrp:
                      type: number
                      format: float
                      minimum: 0
                      example: 20.99
                      description: "Maximum retail price (must be >= 0)"
                    discounted_price:
                      type: number
                      format: float
                      minimum: 0
                      example: 15.99
                      description: "Discounted price (must be >= 0)"
                    quantity:
                      type: integer
                      minimum: 0
                      example: 100
                      description: "Stock quantity (must be integer >= 0)"
                    book_details:
                      type: string
                      nullable: true
                      example: "A story of the fabulously wealthy Jay Gatsby"
                      description: "Additional book details (optional)"
                    genre:
                      type: string
                      nullable: true
                      example: "Fiction"
                      description: "Book genre (optional)"
                    book_image:
                      type: string
                      nullable: true
                      example: "http://example.com/book-cover.jpg"
                      description: "URL to book cover image (optional)"
                  required:
                    - name
                    - author
                    - mrp
                    - discounted_price
                    - quantity
      responses:
        "201":
          description: Book successfully created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book created successfully"
                  book:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      name:
                        type: string
                        example: "The Great Gatsby"
                      author:
                        type: string
                        example: "F. Scott Fitzgerald"
                      mrp:
                        type: number
                        format: float
                        example: 20.99
                      discounted_price:
                        type: number
                        format: float
                        example: 15.99
                      quantity:
                        type: integer
                        example: 100
                      book_details:
                        type: string
                        nullable: true
                        example: "A story of the fabulously wealthy Jay Gatsby"
                      genre:
                        type: string
                        nullable: true
                        example: "Fiction"
                      book_image:
                        type: string
                        nullable: true
                        example: "http://example.com/book-cover.jpg"
        "400":
          description: Invalid request or book already in wishlist
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Invalid request"
        "422":
          description: Validation error (unprocessable entity)
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    examples:
                      missing_fields:
                        value: ["Name can't be blank", "Author can't be blank"]
                      invalid_numbers:
                        value: ["Mrp must be greater than or equal to 0"]
                      invalid_quantity:
                        value: ["Quantity must be an integer"]
        "401":
          description: Unauthorized - Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Unauthorized"
    get:
      summary: Get All Books
      description: Retrieves a paginated list of all non-deleted books, ordered by creation date (newest first)
      tags:
        - Books
      parameters:
        - name: page
          in: query
          required: false
          description: Page number for pagination (default:1)
          schema:
            type: integer
            example: 1
            default: 1
        - name: per_page
          in: query
          required: false
          description: Number of books per page (default:10)
          schema:
            type: integer
            example: 10
            default: 10
      responses:
        "200":
          description: Books retrieved successfully (returns array even if empty)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Books retrieved successfully"
                  books:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        name:
                          type: string
                          example: "The Great Gatsby"
                        author:
                          type: string
                          example: "F. Scott Fitzgerald"
                        mrp:
                          type: number
                          format: float
                          example: 20.99
                        discounted_price:
                          type: number
                          format: float
                          example: 15.99
                        quantity:
                          type: integer
                          example: 100
                        book_details:
                          type: string
                          nullable: true
                          example: "A story of the fabulously wealthy Jay Gatsby"
                        genre:
                          type: string
                          nullable: true
                          example: "Fiction"
                        book_image:
                          type: string
                          nullable: true
                          example: "http://example.com/book-cover.jpg"
                  pagination:
                    type: object
                    properties:
                      current_page:
                        type: integer
                        example: 1
                      per_page:
                        type: integer
                        example: 10
                      total_pages:
                        type: integer
                        example: 5
                      total_count:
                        type: integer
                        example: 50
              examples:
                with_books:
                  summary: Successful response with books
                  value:
                    message: "Books retrieved successfully"
                    books:
                      - id: 1
                        name: "The Great Gatsby"
                        author: "F. Scott Fitzgerald"
                        mrp: 20.99
                        discounted_price: 15.99
                        quantity: 100
                        book_details: "A story of the fabulously wealthy Jay Gatsby"
                        genre: "Fiction"
                        book_image: "http://example.com/book-cover.jpg"
                      - id: 2
                        name: "1984"
                        author: "George Orwell"
                        mrp: 15.99
                        discounted_price: 12.99
                        quantity: 50
                        book_details: "A dystopian novel"
                        genre: "Science Fiction"
                        book_image: "http://example.com/1984-cover.jpg"
                    pagination:
                      current_page: 1
                      per_page: 10
                      total_pages: 5
                      total_count: 50
                no_books:
                  summary: Successful response with no books
                  value:
                    message: "No books available"
                    books: []
                    pagination:
                      current_page: 1
                      per_page: 10
                      total_pages: 0
                      total_count: 0
        "500":
          description: Internal Server Error - Database or server failure
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Internal server error occurred while retrieving books"
              example:
                errors: "Internal server error occurred while retrieving books"

  /api/v1/books/search_suggestions:
    get:
      summary: Search Suggestions
      description: Retrieves search suggestions based on a query string for book names, authors, or genres
      tags:
        - Books
      parameters:
        - name: query
          in: query
          required: true
          description: The search query to generate suggestions
          schema:
            type: string
            example: "Gatsby"
      responses:
        "200":
          description: Search suggestions retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Search suggestions retrieved successfully"
                  suggestions:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: "The Great Gatsby"
                        author:
                          type: string
                          example: "F. Scott Fitzgerald"
                        genre:
                          type: string
                          nullable: true
                          example: "Fiction"
              examples:
                with_suggestions:
                  summary: Successful response with suggestions
                  value:
                    message: "Search suggestions retrieved successfully"
                    suggestions:
                      - name: "The Great Gatsby"
                        author: "F. Scott Fitzgerald"
                        genre: "Fiction"
                      - name: "Gatsby's Adventure"
                        author: "Jane Doe"
                        genre: "Fiction"
                no_suggestions:
                  summary: Successful response with no suggestions
                  value:
                    message: "Search suggestions retrieved successfully"
                    suggestions: []
        "422":
          description: Validation error (query missing or error retrieving suggestions)
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Query parameter is required"
              examples:
                missing_query:
                  value:
                    errors: "Query parameter is required"
                error:
                  value:
                    errors: "Error retrieving suggestions: some error message"

  /api/v1/wishlists:
    post:
      summary: Add Book to Wishlist
      description: Adds a book to the authenticated user's wishlist.
      tags:
        - Wishlists
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: Authorization
          required: true
          description: Bearer token for authentication
          schema:
            type: string
            example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                wishlist:
                  type: object
                  properties:
                    book_id:
                      type: integer
                      example: 456
                      description: "The ID of the book to add to the wishlist"
                  required:
                    - book_id
      responses:
        "201":
          description: Book successfully added to wishlist
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book added to wishlist!"
        "401":
          description: Unauthorized - Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid token"
        "404":
          description: User or Book not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    examples:
                      user_not_found:
                        value: "User not found"
                      book_not_found:
                        value: "Book not found"
        "422":
          description: Validation error or book already in wishlist
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Book is already in your wishlist"]
    get:
      summary: Get All Wishlist Items
      description: Retrieves all active books in the authenticated user's wishlist.
      tags:
        - Wishlists
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: Authorization
          required: true
          description: Bearer token for authentication
          schema:
            type: string
            example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        "200":
          description: Wishlist retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: array
                    items:
                      type: object
                      properties:
                        book_id:
                          type: integer
                          example: 456
                        user_id:
                          type: integer
                          example: 12
              examples:
                with_items:
                  summary: Wishlist with items
                  value:
                    message:
                      - book_id: 456
                        user_id: 12
                empty_wishlist:
                  summary: Empty wishlist
                  value:
                    message: []
        "401":
          description: Unauthorized - Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid token"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "User not found"

  /api/v1/wishlists/{wishlist_id}:
    patch:
      summary: Remove Book from Wishlist
      description: Marks a book as deleted in the authenticated user's wishlist.
      tags:
        - Wishlists
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: Authorization
          required: true
          description: Bearer token for authentication
          schema:
            type: string
            example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        - name: wishlist_id
          in: path
          required: true
          description: The ID of the wishlist item to be removed
          schema:
            type: integer
            example: 456
      responses:
        "200":
          description: Book successfully removed from wishlist
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book removed from wishlist!"
        "401":
          description: Unauthorized - Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid token"
        "404":
          description: User not found or book not in wishlist
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    examples:
                      user_not_found:
                        value: "User not found"
                      book_not_found:
                        value: "Book not found in wishlist"

  /api/v1/books/{id}:
    patch:
      summary: Update Book
      description: Updates an existing book with the provided details
      tags:
        - Books
      security: 
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The ID of the book to update
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                book:
                  type: object
                  properties:
                    name:
                      type: string
                      example: "The Great Gatsby"
                      minLength: 1
                      description: "Book title"
                    author:
                      type: string
                      example: "F. Scott Fitzgerald"
                      minLength: 1
                      description: "Author name"
                    mrp:
                      type: number
                      format: float
                      minimum: 0
                      example: 20.99
                      description: "Maximum retail price (must be >= 0)"
                    discounted_price:
                      type: number
                      format: float
                      minimum: 0
                      example: 15.99
                      description: "Discounted price (must be >= 0)"
                    quantity:
                      type: integer
                      minimum: 0
                      example: 100
                      description: "Stock quantity (must be integer >= 0)"
                    book_details:
                      type: string
                      nullable: true
                      example: "A story of the fabulously wealthy Jay Gatsby"
                      description: "Additional book details (optional)"
                    genre:
                      type: string
                      nullable: true
                      example: "Fiction"
                      description: "Book genre (optional)"
                    book_image:
                      type: string
                      nullable: true
                      example: "http://example.com/book-cover.jpg"
                      description: "URL to book cover image (optional)"
      responses:
        "200":
          description: Book successfully updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book updated successfully"
                  book:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      name:
                        type: string
                        example: "The Great Gatsby"
                      author:
                        type: string
                        example: "F. Scott Fitzgerald"
                      mrp:
                        type: number
                        format: float
                        example: 20.99
                      discounted_price:
                        type: number
                        format: float
                        example: 15.99
                      quantity:
                        type: integer
                        example: 100
                      book_details:
                        type: string
                        nullable: true
                        example: "A story of the fabulously wealthy Jay Gatsby"
                      genre:
                        type: string
                        nullable: true
                        example: "Fiction"
                      book_image:
                        type: string
                        nullable: true
                        example: "http://example.com/book-cover.jpg"
        "422":
          description: Validation error or book not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    examples:
                      not_found:
                        value: ["Book not found or has been deleted"]
                      validation_errors:
                        value: ["Name can't be blank", "Mrp must be greater than or equal to 0"]
    delete:
      summary: Hard Delete a Book
      description: Permanently deletes a book by its ID from the database
      tags:
        - Books
      security: 
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The ID of the book to delete
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: Book permanently deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book permanently deleted"
              example:
                message: "Book permanently deleted"
        "404":
          description: Book not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Book not found"
              example:
                errors: "Book not found"
    get:
      summary: Get Book by ID
      description: Retrieves a specific book by its ID, if it exists and is not deleted
      tags:
        - Books
      parameters:
        - name: id
          in: path
          required: true
          description: The ID of the book to retrieve
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: Book retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book retrieved successfully"
                  book:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      name:
                        type: string
                        example: "The Great Gatsby"
                      author:
                        type: string
                        example: "F. Scott Fitzgerald"
                      mrp:
                        type: number
                        format: float
                        example: 20.99
                      discounted_price:
                        type: number
                        format: float
                        example: 15.99
                      quantity:
                        type: integer
                        example: 100
                      book_details:
                        type: string
                        nullable: true
                        example: "A story of the fabulously wealthy Jay Gatsby"
                      genre:
                        type: string
                        nullable: true
                        example: "Fiction"
                      book_image:
                        type: string
                        nullable: true
                        example: "http://example.com/book-cover.jpg"
        "404":
          description: Book not found or has been deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Book not found or has been deleted"
              example:
                errors: "Book not found or has been deleted"

  /api/v1/books/stock:
    get:
      summary: Get Book Stock
      description: Retrieves the stock quantities for a list of books specified by their IDs.
      tags:
        - Books
      security: 
        - BearerAuth: []
      parameters:
        - name: book_ids
          in: query
          required: true
          description: A comma-separated list of book IDs to fetch stock for
          schema:
            type: string
            example: "1,2,3"
      responses:
        "200":
          description: Stock retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  stock:
                    type: array
                    items:
                      type: object
                      properties:
                        book_id:
                          type: integer
                          example: 1
                        quantity:
                          type: integer
                          example: 100
                required:
                  - success
                  - stock
        "400":
          description: Bad request - book_ids parameter is missing
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "book_ids parameter is required"
                required:
                  - success
                  - error
        "422":
          description: Unprocessable entity - invalid book_ids, no books found, or some books missing
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    examples:
                      invalid_ids:
                        value: "Invalid book_ids: must be an array of positive integers"
                      no_books:
                        value: "No books found for the given IDs"
                      missing_books:
                        value: "Books not found: 4, 5"
                      server_error:
                        value: "Failed to fetch stock quantities: database error"
                required:
                  - success
                  - error
                  
  /api/v1/books/delete/{id}:
    patch:
      summary: Toggle Delete Status of a Book
      description: Toggles the delete status of a book (marks as deleted or restores it) by its ID
      tags:
        - Books
      security: 
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: The ID of the book to toggle delete status
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: Book delete status toggled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book marked as deleted"
                  book:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      name:
                        type: string
                        example: "The Great Gatsby"
                      author:
                        type: string
                        example: "F. Scott Fitzgerald"
                      mrp:
                        type: number
                        format: float
                        example: 20.99
                      discounted_price:
                        type: number
                        format: float
                        example: 15.99
                      quantity:
                        type: integer
                        example: 100
                      book_details:
                        type: string
                        nullable: true
                        example: "A story of the fabulously wealthy Jay Gatsby"
                      genre:
                        type: string
                        nullable: true
                        example: "Fiction"
                      book_image:
                        type: string
                        nullable: true
                        example: "http://example.com/book-cover.jpg"
                      is_deleted:
                        type: boolean
                        example: true
              examples:
                marked_as_deleted:
                  summary: Book marked as deleted
                  value:
                    message: "Book marked as deleted"
                    book:
                      id: 1
                      name: "The Great Gatsby"
                      author: "F. Scott Fitzgerald"
                      mrp: 20.99
                      discounted_price: 15.99
                      quantity: 100
                      book_details: "A story of the fabulously wealthy Jay Gatsby"
                      genre: "Fiction"
                      book_image: "http://example.com/book-cover.jpg"
                      is_deleted: true
                restored:
                  summary: Book restored
                  value:
                    message: "Book restored"
                    book:
                      id: 1
                      name: "The Great Gatsby"
                      author: "F. Scott Fitzgerald"
                      mrp: 20.99
                      discounted_price: 15.99
                      quantity: 100
                      book_details: "A story of the fabulously wealthy Jay Gatsby"
                      genre: "Fiction"
                      book_image: "http://example.com/book-cover.jpg"
                      is_deleted: false
        "422":
          description: Book not found or update failed due to validation errors
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    oneOf:
                      - type: string
                      - type: array
                        items:
                          type: string
              examples:
                not_found:
                  summary: Book not found
                  value:
                    errors: "Book not found"
                validation_error:
                  summary: Validation error
                  value:
                    errors: ["Some validation error"]

  /api/v1/reviews:
    post:
      summary: Add a Review
      description: Allows a user to add a review for a book.
      tags:
        - Reviews
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                review:
                  type: object
                  properties:
                    user_id:
                      type: integer
                      example: 1
                    book_id:
                      type: integer
                      example: 5
                    rating:
                      type: integer
                      example: 4
                    comment:
                      type: string
                      example: "Great book! Highly recommend."
                  required:
                    - user_id
                    - book_id
                    - rating
                    - comment
      responses:
        "201":
          description: Review successfully added
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Review added successfully"
                  review:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 10
                      user_id:
                        type: integer
                        example: 1
                      book_id:
                        type: integer
                        example: 5
                      rating:
                        type: integer
                        example: 4
                      comment:
                        type: string
                        example: "Great book! Highly recommend."
        "422":
          description: Validation error (unprocessable entity)
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                      example: "Rating can't be blank"

  /api/v1/reviews/{book_id}:
    get:
      summary: Get Reviews for a Book
      description: Fetches all reviews for a specific book.
      tags:
        - Reviews
      parameters:
        - name: book_id
          in: path
          required: true
          description: ID of the book whose reviews need to be fetched
          schema:
            type: integer
            example: 5
      responses:
        "200":
          description: Successfully fetched reviews
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  reviews:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 10
                        user_id:
                          type: integer
                          example: 1
                        book_id:
                          type: integer
                          example: 5
                        rating:
                          type: integer
                          example: 4
                        comment:
                          type: string
                          example: "Great book! Highly recommend."
        "404":
          description: Book not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Book not found"

  /api/v1/reviews/{id}:
    delete:
      summary: Delete a Review
      description: Deletes a review by its ID.
      tags:
        - Reviews
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID of the review to be deleted
          schema:
            type: integer
            example: 10
      responses:
        "200":
          description: Review deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Review deleted successfully"
        "404":
          description: Review not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Review not found"

  /api/v1/addresses:
    get:
      summary: List Addresses
      description: Retrieves all addresses for the authenticated user.
      tags:
        - Addresses
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: Authorization
          required: true
          description: Bearer token for authentication
          schema:
            type: string
            example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        "200":
          description: Addresses retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  addresses:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        street:
                          type: string
                          example: "123 Main St"
                        city:
                          type: string
                          example: "Delhi"
                        state:
                          type: string
                          example: "DL"
                        zip_code:
                          type: string
                          example: "110001"
                        country:
                          type: string
                          example: "India"
                        type:
                          type: string
                          example: "home"
                          enum: ["home", "work", "other"]
                        is_default:
                          type: boolean
                          example: false
              examples:
                with_addresses:
                  summary: Successful response with addresses
                  value:
                    addresses:
                      - id: 1
                        street: "123 Main St"
                        city: "Delhi"
                        state: "DL"
                        zip_code: "110001"
                        country: "India"
                        type: "home"
                        is_default: false
                no_addresses:
                  summary: Successful response with no addresses
                  value:
                    addresses: []
        "401":
          description: Unauthorized - Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Unauthorized"
    post:
      summary: Add Address
      description: Adds a new address for the authenticated user.
      tags:
        - Addresses
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: Authorization
          required: true
          description: Bearer token for authentication
          schema:
            type: string
            example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                address:
                  type: object
                  properties:
                    street:
                      type: string
                      example: "123 Main St"
                    city:
                      type: string
                      example: "Delhi"
                    state:
                      type: string
                      example: "DL"
                    zip_code:
                      type: string
                      example: "110001"
                    country:
                      type: string
                      example: "India"
                    type:
                      type: string
                      example: "home"
                      enum: ["home", "work", "other"]
                    is_default:
                      type: boolean
                      example: false
                  required:
                    - street
                    - city
                    - state
                    - zip_code
                    - country
      responses:
        "201":
          description: Address successfully added
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Address added successfully"
                  address:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      street:
                        type: string
                        example: "123 Main St"
                      city:
                        type: string
                        example: "Delhi"
                      state:
                        type: string
                        example: "DL"
                      zip_code:
                        type: string
                        example: "110001"
                      country:
                        type: string
                        example: "India"
                      type:
                        type: string
                        example: "home"
                        enum: ["home", "work", "other"]
                      is_default:
                        type: boolean
                        example: false
        "401":
          description: Unauthorized - Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Unauthorized"
        "422":
          description: Validation error (unprocessable entity)
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    examples:
                      missing_fields:
                        value: ["Street can't be blank", "City can't be blank"]
                      invalid_type:
                        value: ["Type is not included in the list"]

  /api/v1/addresses/{id}:
    patch:
      summary: Update Address
      description: Updates an existing address for the authenticated user.
      tags:
        - Addresses
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: Authorization
          required: true
          description: Bearer token for authentication
          schema:
            type: string
            example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        - name: id
          in: path
          required: true
          description: The ID of the address to update
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                address:
                  type: object
                  properties:
                    street:
                      type: string
                      example: "456 New St"
                    city:
                      type: string
                      example: "Mumbai"
                    state:
                      type: string
                      example: "MH"
                    zip_code:
                      type: string
                      example: "400001"
                    country:
                      type: string
                      example: "India"
                    type:
                      type: string
                      example: "work"
                      enum: ["home", "work", "other"]
                    is_default:
                      type: boolean
                      example: true
      responses:
        "200":
          description: Address successfully updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Address updated successfully"
                  address:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      street:
                        type: string
                        example: "456 New St"
                      city:
                        type: string
                        example: "Mumbai"
                      state:
                        type: string
                        example: "MH"
                      zip_code:
                        type: string
                        example: "400001"
                      country:
                        type: string
                        example: "India"
                      type:
                        type: string
                        example: "work"
                        enum: ["home", "work", "other"]
                      is_default:
                        type: boolean
                        example: true
        "401":
          description: Unauthorized - Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Unauthorized"
        "404":
          description: Address not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Address not found"
        "422":
          description: Validation error (unprocessable entity)
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    examples:
                      validation_errors:
                        value: ["Street can't be blank"]
                      invalid_type:
                        value: ["Type is not included in the list"]
    delete:
      summary: Remove Address
      description: Deletes an address for the authenticated user by its ID.
      tags:
        - Addresses
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: Authorization
          required: true
          description: Bearer token for authentication
          schema:
            type: string
            example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        - name: id
          in: path
          required: true
          description: The ID of the address to delete
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: Address successfully removed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Address removed successfully"
        "401":
          description: Unauthorized - Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Unauthorized"
        "404":
          description: Address not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Address not found"

  /api/v1/orders:
    post:
      summary: Create Order
      description: Places an order for a book.
      tags:
        - Orders
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: Authorization
          required: true
          description: Bearer token for authentication
          schema:
            type: string
            example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                order:
                  type: object
                  properties:
                    book_id:
                      type: integer
                      example: 1
                    address_id:
                      type: integer
                      example: 10
                    quantity:
                      type: integer
                      example: 2
                  required:
                    - book_id
                    - address_id
                    - quantity
      responses:
        "201":
          description: Order successfully placed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Order placed successfully"
                  order:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 101
                      book_id:
                        type: integer
                        example: 1
                      address_id:
                        type: integer
                        example: 10
                      quantity:
                        type: integer
                        example: 2
                      price_at_purchase:
                        type: number
                        format: float
                        example: 299.99
                      total_price:
                        type: number
                        format: float
                        example: 599.98
                      status:
                        type: string
                        example: "pending"
        "401":
          description: Unauthorized - Invalid Token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Unauthorized"
        "404":
          description: Not Found - User, Book, or Address not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "User not found"
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Quantity must be greater than 0"]
    get:
      summary: Get All Orders
      description: Retrieves all orders for the authenticated user based on the provided JWT token.
      tags:
        - Orders
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: Authorization
          required: true
          description: Bearer token for authentication (e.g., "Bearer <token>")
          schema:
            type: string
            example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        "200":
          description: Orders retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  orders:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 101
                        book_id:
                          type: integer
                          example: 1
                        address_id:
                          type: integer
                          example: 10
                        quantity:
                          type: integer
                          example: 2
                        price_at_purchase:
                          type: number
                          format: float
                          example: 299.99
                        total_price:
                          type: number
                          format: float
                          example: 599.98
                        status:
                          type: string
                          example: "pending"
              examples:
                with_orders:
                  summary: Successful response with orders
                  value:
                    success: true
                    orders:
                      - id: 101
                        book_id: 1
                        address_id: 10
                        quantity: 2
                        price_at_purchase: 299.99
                        total_price: 599.98
                        status: "pending"
                      - id: 102
                        book_id: 2
                        address_id: 10
                        quantity: 1
                        price_at_purchase: 15.99
                        total_price: 15.99
                        status: "shipped"
                no_orders:
                  summary: Successful response with no orders
                  value:
                    success: true
                    orders: []
        "401":
          description: Unauthorized - Invalid token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Unauthorized"
        "422":
          description: Unprocessable Entity - No orders found or other errors
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "No orders found"

  /api/v1/orders/{id}:
    patch:
      summary: Update Order Status
      description: Updates the status of a specific order for the authenticated user.
      tags:
        - Orders
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: Authorization
          required: true
          description: Bearer token for authentication (e.g., "Bearer <token>")
          schema:
            type: string
            example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        - in: path
          name: id
          required: true
          description: The ID of the order to update
          schema:
            type: integer
            example: 101
        - in: query
          name: status
          required: true
          description: The new status for the order
          schema:
            type: string
            enum: ["pending", "processing", "shipped", "delivered", "cancelled"]
            example: "shipped"
      responses:
        "200":
          description: Order status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Order status updated successfully"
                  order:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 101
                      book_id:
                        type: integer
                        example: 1
                      address_id:
                        type: integer
                        example: 10
                      quantity:
                        type: integer
                        example: 2
                      price_at_purchase:
                        type: number
                        format: float
                        example: 299.99
                      total_price:
                        type: number
                        format: float
                        example: 599.98
                      status:
                        type: string
                        enum: ["pending", "processing", "shipped", "delivered", "cancelled"]
                        example: "shipped"
                      created_at:
                        type: string
                        format: date-time
                        example: "2025-03-10T12:00:00Z"
                      updated_at:
                        type: string
                        format: date-time
                        example: "2025-03-10T12:00:00Z"
        "401":
          description: Unauthorized - Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid token"
        "404":
          description: Not Found - User or Order not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    enum:
                      - "User not found"
                      - "Order not found"
        "422":
          description: Unprocessable Entity - Validation errors
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Status must be a valid status"]
    get:
      summary: Get Order by ID
      description: Retrieves a specific order by its ID for the authenticated user.
      tags:
        - Orders
      security:
        - BearerAuth: []
      parameters:
        - in: header
          name: Authorization
          required: true
          description: Bearer token for authentication (e.g., "Bearer <token>")
          schema:
            type: string
            example: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        - name: id
          in: path
          required: true
          description: The ID of the order to retrieve
          schema:
            type: integer
            example: 101
      responses:
        "200":
          description: Order retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  order:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 101
                      book_id:
                        type: integer
                        example: 1
                      address_id:
                        type: integer
                        example: 10
                      quantity:
                        type: integer
                        example: 2
                      price_at_purchase:
                        type: number
                        format: float
                        example: 299.99
                      total_price:
                        type: number
                        format: float
                        example: 599.98
                      status:
                        type: string
                        enum: ["pending", "processing", "shipped", "delivered", "cancelled"]
                        example: "pending"
                      created_at:
                        type: string
                        format: date-time
                        example: "2025-03-10T12:00:00Z"
                      updated_at:
                        type: string
                        format: date-time
                        example: "2025-03-10T12:00:00Z"
        "401":
          description: Unauthorized - Invalid token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid token"
        "404":
          description: Not Found - User or Order not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    enum:
                      - "User not found"
                      - "Order not found"
        "422":
          description: Unprocessable Entity - Other errors
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Unexpected error occurred"]

  /api/v1/carts:
    post:
      summary: Add Book to Cart
      description: Adds a book to the authenticated user's cart. If the book already exists in the cart and is not deleted, the quantity is updated. Requires authentication via Bearer token.
      tags:
        - Carts
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                cart:
                  type: object
                  properties:
                    user_id:
                      type: integer
                      example: 1
                      description: The ID of the user adding the book to the cart
                    book_id:
                      type: integer
                      example: 456
                      description: The ID of the book to add to the cart
                    quantity:
                      type: integer
                      minimum: 1
                      example: 2
                      description: The quantity of the book to add
                  required:
                    - user_id
                    - book_id
                    - quantity
      responses:
        "200":
          description: Book successfully added to or updated in the cart
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book added to cart"
                  cart:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      user_id:
                        type: integer
                        example: 1
                      book_id:
                        type: integer
                        example: 456
                      quantity:
                        type: integer
                        example: 2
                      is_deleted:
                        type: boolean
                        example: false
              examples:
                new_book:
                  summary: New book added to cart
                  value:
                    message: "Book added to cart"
                    cart:
                      id: 1
                      user_id: 1
                      book_id: 456
                      quantity: 2
                      is_deleted: false
                updated_quantity:
                  summary: Existing book quantity updated
                  value:
                    message: "Book quantity updated in cart"
                    cart:
                      id: 1
                      user_id: 1
                      book_id: 456
                      quantity: 5
                      is_deleted: false
        "401":
          description: Unauthorized - Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid token"
        "404":
          description: Not Found - User or Book not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "User not found"
        "422":
          description: Validation error (e.g., invalid quantity or database errors)
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Quantity must be greater than 0"]
              examples:
                invalid_quantity:
                  summary: Invalid quantity provided
                  value:
                    errors: ["Invalid quantity"]
                db_error:
                  summary: Database validation error
                  value:
                    errors: ["User must exist", "Book must exist"]
    patch:
      summary: Update Cart Quantity
      description: Updates the quantity of a book in the authenticated user's cart.
      tags:
        - Carts
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                book_id:
                  type: integer
                  example: 456
                  description: The ID of the book in the cart to update
                quantity:
                  type: integer
                  example: 3
                  description: The new quantity for the book in the cart
              required:
                - book_id
                - quantity
      responses:
        "200":
          description: Cart quantity updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Cart quantity updated"
                  cart:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      user_id:
                        type: integer
                        example: 1
                      book_id:
                        type: integer
                        example: 456
                      quantity:
                        type: integer
                        example: 3
                      is_deleted:
                        type: boolean
                        example: false
                required:
                  - success
                  - message
                  - cart
        "401":
          description: Unauthorized - Invalid or missing token
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Invalid token"
                required:
                  - success
                  - error
        "422":
          description: Unprocessable entity - Invalid quantity, cart item not found, or save failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    examples:
                      invalid_quantity:
                        value: "Invalid quantity"
                      not_found:
                        value: "Cart item not found"
                      validation_error:
                        value: "Quantity must be greater than zero"
                      server_error:
                        value: "Error updating cart quantity: database error"
                required:
                  - success
                  - error

  /api/v1/carts/{user_id}:
    get:
      summary: Get User Cart
      description: Retrieves all active items (not soft-deleted) in the specified user's cart, including book details and quantities. Requires authentication via Bearer token.
      tags:
        - Carts
      security:
        - BearerAuth: []
      parameters:
        - name: user_id
          in: path
          required: true
          description: The ID of the user whose cart is being retrieved
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: Cart retrieved successfully (returns array even if empty)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Cart retrieved successfully"
                  cart:
                    type: array
                    items:
                      type: object
                      properties:
                        cart_id:
                          type: integer
                          example: 1
                        book_id:
                          type: integer
                          example: 456
                        book_name:
                          type: string
                          example: "Ruby on Rails Guide"
                        quantity:
                          type: integer
                          example: 2
                        price:
                          type: number
                          format: float
                          example: 800.0
              examples:
                with_items:
                  summary: Cart with items
                  value:
                    success: true
                    message: "Cart retrieved successfully"
                    cart:
                      - cart_id: 1
                        book_id: 456
                        book_name: "Ruby on Rails Guide"
                        quantity: 2
                        price: 800.0
                empty_cart:
                  summary: Empty cart
                  value:
                    success: true
                    message: "Cart is empty"
                    cart: []
        "401":
          description: Unauthorized - Token missing or invalid
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid token"
        "404":
          description: Not Found - User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "User not found"
        "422":
          description: Error retrieving cart (e.g., database error)
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: string
                    example: "Error retrieving cart: Database connection failed"

  /api/v1/carts/{book_id}:
    delete:
      summary: Remove Book from Cart
      description: Soft-deletes a book from the authenticated user's cart by setting `is_deleted` to true. Requires authentication via Bearer token, which is decoded to identify the user.
      tags:
        - Carts
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: book_id
          required: true
          description: The ID of the book to soft-delete from the user's cart
          schema:
            type: integer
            example: 456
      responses:
        "200":
          description: Cart item successfully soft-deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book removed from cart"
                  book:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      user_id:
                        type: integer
                        example: 1
                      book_id:
                        type: integer
                        example: 456
                      quantity:
                        type: integer
                        example: 2
                      is_deleted:
                        type: boolean
                        example: true
                example:
                  message: "Book removed from cart"
                  book:
                    id: 1
                    user_id: 1
                    book_id: 456
                    quantity: 2
                    is_deleted: true
        "401":
          description: Unauthorized - Token missing or invalid, or user not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "User not found"
                example:
                  error: "User not found"
        "404":
          description: Cart item not found for the given book ID and user
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Cart item not found"
                example:
                  error: "Cart item not found"
        "422":
          description: Error during update (e.g., database validation errors)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: array
                    items:
                      type: string
                    example: ["Failed to update cart item"]
                example:
                  error: ["Failed to update cart item"]

  /api/v1/google_auth:
    post:
      summary: Google SOS Authentication
      description: Authenticates a user via Google OAuth, creating or linking an account, and returns a JWT token.
      tags:
        - Google Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                  example: "google-oauth-token"
                  description: The Google ID token obtained from Google OAuth
              required:
                - token
      responses:
        "200":
          description: Authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Authentication successful"
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiJ9.eyJpZCI6MSwibmFtZSI6IkpvaG4gRG9lIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.signature"
                  user_id:
                    type: integer
                    example: 1
                  user_name:
                    type: string
                    example: "John Doe"
                  email:
                    type: string
                    example: "user@example.com"
                  mobile_number:
                    type: string
                    nullable: true
                    example: "+919876543210"
                required:
                  - message
                  - token
                  - user_id
                  - user_name
                  - email
        "401":
          description: Unauthorized - Invalid Google token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid token"
                  details:
                    type: string
                    nullable: true
                    example: "Token signature verification failed"
                required:
                  - error
        "422":
          description: Unprocessable entity - Failed to create or update user
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Failed to create or update user"
                  details:
                    type: string
                    nullable: true
                    example: "Email can't be blank"
                required:
                  - error